@page
@model WebHomePro.Pages.Admin.DesactivarLineaModel
@{
    Layout = null;
    ViewData["Title"] = "Desactivar Línea Telefónica";
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Desactivar Línea - HomePro</title>
    <link rel="icon" type="image/x-icon" href="~/assets/favicon.ico" />

    <!-- FontAwesome + Google Fonts -->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" />

    <!-- CSS -->
    <link href="~/css/StyleMenuAdmin.css" rel="stylesheet" />
</head>
    <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
        <div class="container px-4 px-lg-5">
            <a class="navbar-brand" asp-page="/Admin/MenuAdmin">
                <img src="~/img/LOGO HOMEPRO.png" alt="Logo" style="height: 5rem;" />
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive">
                Menu <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto py-4 py-lg-0">
                    <li class="nav-item">
                        <a class="nav-link px-lg-3 py-3 py-lg-4" asp-page="/Admin/Nuevas_LineasTELE">
                            Nuevas líneas telefónicas
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link px-lg-3 py-3 py-lg-4" asp-page="/Admin/ActivarLinea">
                            Activar una línea recién vendida
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link px-lg-3 py-3 py-lg-4" asp-page="/Admin/DesactivarLinea">
                            Devolución de una línea telefónica
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link px-lg-3 py-3 py-lg-4" asp-page="/Admin/CalcularFacturacion">
                            Calcular facturación
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link px-lg-3 py-3 py-lg-4" asp-page="/Admin/Nuevos_Admin">
                            Nuevos usuarios administrativos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link px-lg-3 py-3 py-lg-4" asp-page="/Login">
                            Salir del Sitio
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

        <!-- Page Header (igual que Nuevas_LineasTELE) -->
        <header class="masthead" style="background-image: url('@Url.Content("~/img/home-bg.jpg")')">
            <div class="container position-relative px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="site-heading">
                            <h1>Desactivar Línea Telefónica</h1>
                            <span class="subheading">Gestioná líneas telefónicas activas fácilmente</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

    <!-- CONTENIDO -->
    <main class="py-4">
        <div class="container-fluid px-3 px-lg-4">

            <div class="d-flex flex-wrap align-items-center justify-content-between mb-3">
                <h1 class="page-title h3 mb-2">Desactivar Línea Telefónica</h1>
                <span class="badge badge-soft rounded-pill px-3 py-2">
                    @Model.LineasEnUso?.Count ?? 0 @((Model.LineasEnUso?.Count ?? 0) == 1 ? "activa" : "activas")
                </span>
            </div>

            @if (!string.IsNullOrEmpty(Model.Mensaje))
            {
                <div class="alert alert-info">@Model.Mensaje</div>
            }

            @if (TempData["Flash"] is string msg && !string.IsNullOrWhiteSpace(msg))
            {
                <div class="alert alert-info">@msg</div>
            }

            <!-- Filtro rápido -->
            <div class="row g-3 mb-3">
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="input-group">
                        <span class="input-group-text"><i class="fa-solid fa-magnifying-glass"></i></span>
                        <input id="filtro" type="text" class="form-control" placeholder="Buscar por teléfono o nombre…">
                    </div>
                </div>
            </div>

            <div class="card shadow-sm">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0" id="tablaLineas">
                            <thead class="border-bottom">
                                <tr>
                                    <th>Teléfono</th>
                                    <th>ID Tarjeta</th>
                                    <th>ID Teléfono</th>
                                    <th>Cédula</th>
                                    <th>Nombre Cliente</th>
                                    <th>Tipo</th>
                                    <th class="text-center">Acción</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var linea in Model.LineasEnUso)
                                {
                                    <tr>
                                        <td>@linea.NumeroTelefono</td>
                                        <td class="text-nowrap">@linea.IdentificadorTarjeta</td>
                                        <td class="text-nowrap">@linea.IdentificadorTelefono</td>
                                        <td>@linea.IdCliente</td>
                                        <td><span class="truncate" title="@linea.NombreCliente">@linea.NombreCliente</span></td>
                                        <td class="text-uppercase">@linea.TipoServicio</td>
                                        <td class="text-center">
                                            <form method="post" asp-page-handler="Desactivar" class="d-inline">
                                                @Html.AntiForgeryToken()
                                                <input type="hidden" name="NumeroTelefono" value="@linea.NumeroTelefono" />
                                                <input type="hidden" name="IdTelefono" value="@linea.IdentificadorTelefono" />
                                                <input type="hidden" name="IdTarjeta" value="@linea.IdentificadorTarjeta" />
                                                <input type="hidden" name="IdCliente" value="@linea.IdCliente" />
                                                <input type="hidden" name="Tipo" value="@linea.TipoServicio" />
                                                <button type="submit" class="btn btn-danger btn-sm"
                                                        onclick="return confirm('¿Está seguro que desea desactivar la línea @linea.NumeroTelefono ?');">
                                                    <i class="fa-solid fa-ban me-1"></i> Desactivar
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- FOOTER -->
    <footer class="border-top py-3 bg-white">
        <div class="container-fluid px-3 px-lg-4">
            <div class="small text-center text-muted">Derechos Reservados &copy; HomePro 2025</div>
        </div>
    </footer>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Filtro simple por teléfono o nombre
        const filtro = document.getElementById('filtro');
        const tabla  = document.getElementById('tablaLineas').getElementsByTagName('tbody')[0];
        filtro?.addEventListener('input', function () {
            const q = this.value.toLowerCase().trim();
            for (const tr of tabla.rows) {
                const tel = tr.cells[0].innerText.toLowerCase();
                const nom = tr.cells[4].innerText.toLowerCase();
                tr.style.display = (tel.includes(q) || nom.includes(q)) ? '' : 'none';
            }
        });
    </script>
</body>
</html>